{"version":3,"file":"a11y-bar-panel.js","sourceRoot":"","sources":["../../../src/templates/a11y-bar-panel.ts"],"names":[],"mappings":"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","sourcesContent":["import { html, LitElement } from \"lit\";\nimport { property } from \"lit/decorators.js\";\nimport { GenericOption } from \"../settings/types\";\nimport { getFocusableElements, getNextFocusableElement } from \"src/utils\";\n\nexport interface A11yBarPanelElement extends HTMLElement {\n  options: GenericOption[];\n  currentSelection: string;\n  label: string;\n  type: string;\n  action: (option: string) => void;\n  triggerId: string;\n  parentId: string;\n  open: boolean;\n  showPanel: (selection: string) => void;\n  hidePanel: () => void;\n}\n\nexport class A11yBarPanel extends LitElement {\n  @property({ type: Array }) options: GenericOption[] = [];\n  currentSelection: string = \"\";\n  @property({ type: String }) label: string = \"\";\n  @property({ type: String }) type: string = \"\";\n  @property({ type: Function }) action!: (option: string) => void;\n  @property({ type: String }) triggerId: string = \"\";\n  @property({ type: String }) parentId: string = \"\";\n  @property({ type: Boolean }) open: boolean = false;\n\n  createRenderRoot() {\n    return this; // disables shadow DOM\n  }\n\n  handleSelectionChange(event: Event) {\n    const target = event.target as HTMLInputElement;\n    this.action(target.value);\n    this.updatePanelPosition();\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n    this.setAttribute(\"role\", \"dialog\");\n    this.setAttribute(\"aria-label\", this.type + \" options\");\n  }\n\n  updated(changedProperties: Map<string | number | symbol, unknown>) {\n    if (changedProperties.has(\"label\")) {\n      this.setAttribute(\"aria-label\", \"a11y center \" + this.type + \" options\");\n    }\n  }\n\n  disconnectedCallback() {\n    super.disconnectedCallback();\n    if (this.parentElement) {\n      this.parentElement.removeChild(this);\n    }\n  }\n\n  updatePanelPosition() {\n    const a11yBar = document.querySelector(\"#\" + this.parentId) as HTMLElement;\n    if (a11yBar) {\n      const a11yBarWidth = a11yBar.offsetWidth;\n      this.style.right = `${a11yBarWidth}px`;\n    }\n  }\n\n  handleKeyboardNavigation(event: KeyboardEvent) {\n    const trigger = document.getElementById(this.triggerId) as HTMLElement;\n    const focusableElements = getFocusableElements(this);\n    const radioInputs = Array.from(this.querySelectorAll(\".usa-radio__input\"));\n    const firstFocusableElement = focusableElements[0];\n    const lastFocusableElement =\n      focusableElements[focusableElements.length - 1];\n\n    const isRadioInput = (element: HTMLElement) =>\n      radioInputs.includes(element);\n    const getFieldset = (element: HTMLElement) => element.closest(\"fieldset\");\n\n    if (this.open && event.key === \"Tab\" && !event.shiftKey) {\n      if (event.target === trigger) {\n        event.preventDefault();\n        if (radioInputs.length > 0) {\n          const selectedRadio =\n            radioInputs.find((radio) => (radio as HTMLInputElement).checked) ||\n            radioInputs[0];\n          (selectedRadio as HTMLInputElement).focus();\n        } else {\n          firstFocusableElement?.focus();\n        }\n        return;\n      } else if (event.target === lastFocusableElement) {\n        event.preventDefault();\n        this.hidePanel();\n        const nextFocusableElement = getNextFocusableElement(\n          this.triggerId,\n          \"a11y-center\"\n        );\n        nextFocusableElement?.focus();\n        return;\n      } else if (isRadioInput(event.target as HTMLElement)) {\n        const currentFieldset = getFieldset(event.target as HTMLElement);\n        if (currentFieldset) {\n          const fieldsets = Array.from(this.querySelectorAll(\"fieldset\"));\n          const currentIndex = fieldsets.indexOf(currentFieldset);\n          if (currentIndex === fieldsets.length - 1) {\n            event.preventDefault();\n            this.hidePanel();\n            const nextFocusableElement = getNextFocusableElement(\n              this.triggerId,\n              \"a11y-center\"\n            );\n            nextFocusableElement?.focus();\n          }\n        }\n        return;\n      }\n    } else if (this.open && event.key === \"Tab\" && event.shiftKey) {\n      if (event.target === firstFocusableElement) {\n        event.preventDefault();\n        trigger?.focus();\n        return;\n      } else if (event.target === trigger) {\n        this.hidePanel();\n        return;\n      } else if (isRadioInput(event.target as HTMLElement)) {\n        const currentFieldset = getFieldset(event.target as HTMLElement);\n        if (currentFieldset) {\n          const fieldsets = Array.from(this.querySelectorAll(\"fieldset\"));\n          const currentIndex = fieldsets.indexOf(currentFieldset);\n          if (currentIndex === 0) {\n            event.preventDefault();\n            trigger?.focus();\n          }\n        }\n        return;\n      }\n    } else if (event.key === \"Escape\") {\n      this.hidePanel();\n      trigger?.focus();\n    }\n  }\n\n  showPanel(currentSelection: string) {\n    this.updatePanelPosition();\n    this.style.display = \"flex\";\n    this.open = true;\n\n    // Update current selection before showing the panel\n    this.currentSelection = currentSelection as string;\n\n    const trigger = document.getElementById(this.triggerId) as HTMLElement;\n    trigger?.setAttribute(\"aria-expanded\", \"true\");\n    trigger?.addEventListener(\n      \"keydown\",\n      this.handleKeyboardNavigation.bind(this)\n    );\n\n    document.addEventListener(\"mousedown\", this.handleDocumentMouseDown);\n    this.addEventListener(\"keydown\", this.handleKeyboardNavigation.bind(this));\n  }\n\n  hidePanel() {\n    this.style.display = \"none\";\n    this.open = false;\n\n    const trigger = document.getElementById(this.triggerId) as HTMLElement;\n    trigger?.removeEventListener(\n      \"keydown\",\n      this.handleKeyboardNavigation.bind(this)\n    );\n    trigger?.setAttribute(\"aria-expanded\", \"false\");\n    document.removeEventListener(\"mousedown\", this.handleDocumentMouseDown);\n    this.removeEventListener(\n      \"keydown\",\n      this.handleKeyboardNavigation.bind(this)\n    );\n  }\n\n  handleDocumentMouseDown = (event: MouseEvent) => {\n    if (\n      this.open &&\n      !this.contains(event.target as Node) &&\n      (event.target as HTMLElement)?.id !== this.triggerId\n    ) {\n      this.hidePanel();\n    }\n  };\n\n  render() {\n    return html`\n      <form\n        class=\"usa-form\"\n        aria-describedby=\"a11y-bar-panel-${this.type}-form-legend\"\n      >\n        <fieldset class=\"usa-fieldset display-flex flex-column gap-05\">\n          <legend\n            id=\"a11y-bar-panel-${this.type}-form-legend\"\n            class=\"usa-legend usa-legend\"\n          >\n            ${this.label}\n          </legend>\n          ${this.options.map(\n            (option) => html`\n              <div class=\"usa-radio\">\n                <input\n                  class=\"usa-radio__input usa-radio__input--tile\"\n                  id=\"a11y-bar-panel-${this.type}-option-${option.label}\"\n                  type=\"radio\"\n                  .checked=\"${this.currentSelection === option.label}\"\n                  @change=\"${this.handleSelectionChange}\"\n                  name=\"a11y-bar-panel-${this.type}-options\"\n                  value=\"${option.label}\"\n                />\n                <label\n                  class=\"usa-radio__label\"\n                  for=\"a11y-bar-panel-${this.type}-option-${option.label}\"\n                  >${option.label}</label\n                >\n              </div>\n            `\n          )}\n        </fieldset>\n      </form>\n    `;\n  }\n}\n\ncustomElements.define(\"a11y-bar-panel\", A11yBarPanel);\n"]}