{"version":3,"file":"a11y-center.js","sourceRoot":"","sources":["../../src/a11y-center.ts"],"names":[],"mappings":"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","sourcesContent":["import { LitElement, html } from \"lit\";\nimport { customElement, property } from \"lit/decorators.js\";\nimport styles from \"./styles/index.css\";\nimport variables from \"./styles/_variables.css\"; // Importing default variables as a string\n\nimport { v4 as uuidv4 } from \"uuid\";\n\nimport { layout } from \"./templates/layout\";\nimport { a11yBar } from \"./templates/a11y-bar\";\nimport { defaultA11ySettings } from \"./settings/defaults\";\nimport { A11ySettings } from \"./settings/types\";\nimport { mergeSettings, getFocusableElements, insertStyleLink, insertStyleElement } from \"./utils\";\n\n@customElement(\"a11y-center\")\nexport class a11yCenter extends LitElement {\n  static styles = [styles];\n  private uniqueIdPrefix: string = \"\";\n  private activeTrigger: HTMLElement | null = null;\n\n  @property({ type: String })\n  header = \"Accessibility Center\";\n\n  @property({ type: Object })\n  settings: A11ySettings = {};\n\n  private mergedSettings!: A11ySettings;\n\n  constructor() {\n    super();\n    this.uniqueIdPrefix = uuidv4().slice(0, 9);\n    this.addTriggerListeners();\n  }\n\n  connectedCallback() {\n    super.connectedCallback();\n    this.updateMergedSettings();\n    this.addTriggerListeners();\n    document.addEventListener(\"keydown\", this.trapFocus);\n  }\n\n  disconnectedCallback() {\n    super.disconnectedCallback();\n    document.removeEventListener(\"keydown\", this.trapFocus);\n  }\n\n  updated(changedProperties: Map<string | number | symbol, unknown>) {\n    if (changedProperties.has(\"settings\")) {\n      this.updateMergedSettings();\n    }\n  }\n\n  updateMergedSettings() {\n    if (!this.settings.id) this.settings.id = defaultA11ySettings.id + \"-\" + this.uniqueIdPrefix;\n    this.mergedSettings = mergeSettings(defaultA11ySettings, this.settings);\n    if (this.mergedSettings.fontSize === true) {\n      this.mergedSettings.fontSize = defaultA11ySettings.fontSize;\n    }\n    if (this.mergedSettings.fontFamily === true) {\n      this.mergedSettings.fontFamily = defaultA11ySettings.fontFamily;\n    }\n    this.injectStylesheet();\n\n  }\n\n  reset() {\n    this.dispatchEvent(new CustomEvent('reset-settings', { bubbles: true, composed: true }));\n  }\n\n  injectStylesheet() {\n    const head = document.head;\n\n    if (this.mergedSettings.tokenURL) {\n      // If a custom stylesheet URL is provided, add it as a link\n      insertStyleLink(\"a11y-center-tokens\", this.mergedSettings.tokenURL);\n    } else {\n      // If no custom stylesheet URL is provided, import the default variables stylesheet\n      insertStyleElement(\"a11y-center-tokens\", variables.toString());\n    }\n\n    insertStyleElement(\"a11y-center-styles\", styles.toString());\n  }\n\n  createRenderRoot() {\n    return this;\n  }\n\n  render() {\n    return html`\n      ${layout(\n        a11yBar(\n          this.closeA11yCenter,\n          this.mergedSettings,\n          this.reset\n        ),\n        this.header,\n        this.mergedSettings.id?? 'a11y-center',\n        \"a11y-bar\"\n      )}\n    `;\n  }\n\n  addTriggerListeners() {\n    // Add event listeners to all elements with the data-a11y-trigger attribute\n    const triggers = document.querySelectorAll(\"[data-a11y-trigger]\");\n    triggers.forEach((trigger) => {\n      trigger.setAttribute(\"aria-controls\", \"a11y-center\");\n      trigger.setAttribute(\"aria-expanded\", \"false\");\n      trigger.addEventListener(\"click\", this.toggleA11yCenter);\n    });\n  }\n\n  toggleA11yCenter = (event: Event) => {\n    const trigger = event.currentTarget as HTMLElement;\n    this.activeTrigger = trigger;\n\n    this.toggleVisibility();\n  };\n\n  closeA11yCenter = () => {\n    const a11yCenterElement = document.getElementById(this.mergedSettings.id?? 'a11y-center');\n    if (a11yCenterElement) {\n      a11yCenterElement.setAttribute(\"aria-hidden\", \"true\");\n      a11yCenterElement.style.visibility = \"hidden\";\n      if (this.activeTrigger) {\n        this.activeTrigger.setAttribute(\"aria-expanded\", \"false\");\n        this.activeTrigger.focus();\n      }\n      // close all a11y-bar-panel elements\n      const a11yBarPanels = a11yCenterElement.querySelectorAll<HTMLElement>(\n        \"a11y-bar-panel\"\n      );\n      a11yBarPanels.forEach((panel: any) => {\n        panel.hidePanel();\n      });\n    }\n  };\n\n  toggleVisibility() {\n    const a11yCenterElement = document.getElementById(this.mergedSettings.id?? 'a11y-center');\n    if (a11yCenterElement) {\n      const isVisible =\n        a11yCenterElement.getAttribute(\"aria-hidden\") === \"false\";\n      if (isVisible) {\n        this.closeA11yCenter();\n      } else {\n        a11yCenterElement.setAttribute(\"aria-hidden\", \"false\");\n        a11yCenterElement.style.visibility = \"visible\";\n        this.activeTrigger?.setAttribute(\"aria-expanded\", \"true\");\n        const firstFocusable = getFocusableElements(a11yCenterElement)[0];\n        firstFocusable?.focus();\n      }\n    }\n  }\n\n  trapFocus = (event: KeyboardEvent) => {\n    // Function to check if the event target is a child of an a11y-bar-panel\n    const isChildOfA11yBarPanel = (element: HTMLElement | null): boolean => {\n      while (element) {\n        if (element.tagName.toLowerCase() === 'a11y-bar-panel') {\n          return true;\n        }\n        element = element.parentElement;\n      }\n      return false;\n    };\n  \n    if (isChildOfA11yBarPanel(event.target as HTMLElement)) {\n      // If the event target is a child of an open a11y-bar-panel, skip the a11y-center focus trap logic\n      return;\n    }\n  \n    const a11yCenterElement = document.getElementById(this.mergedSettings.id?? 'a11y-center');\n    if (\n      !a11yCenterElement ||\n      a11yCenterElement.getAttribute(\"aria-hidden\") === \"true\"\n    ) {\n      return;\n    }\n  \n    const focusableElements = getFocusableElements(a11yCenterElement);\n    const firstElement = focusableElements[0];\n    const lastElement = focusableElements[focusableElements.length - 1];\n  \n    if (event.key === \"Tab\") {\n      if (event.shiftKey) {\n        // Shift + Tab\n        if (document.activeElement === firstElement) {\n          lastElement.focus();\n          event.preventDefault();\n        }\n      } else {\n        // Tab\n        if (document.activeElement === lastElement) {\n          firstElement.focus();\n          event.preventDefault();\n        }\n      }\n    } else if (event.key === \"Escape\") {\n      // Close the modal on Esc\n      this.closeA11yCenter();\n    }\n  };\n  \n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"a11y-center\": a11yCenter;\n  }\n}\n"]}